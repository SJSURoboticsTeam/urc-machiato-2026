[pytest]
# Simplified pytest configuration for URC 2026

# Test discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Output configuration
addopts =
    --verbose
    --tb=short
    --durations=10
    # Note: launch_testing plugins are now enabled for ROS2 Jazzy best practices
    # Use pytest markers to distinguish launch_testing tests from regular pytest tests

# Filter warnings to reduce noise
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning

# Comprehensive test markers for selective execution
markers =
    # Test types
    unit: Unit tests (fast, isolated, <100ms each)
    integration: Integration tests (cross-component, <5s each)
    system: System-level tests (end-to-end, <30s each)
    e2e: End-to-end tests (full system, <60s each)

    # Test characteristics
    critical: Critical system tests (safety, recovery)
    performance: Performance and load tests
    safety: Safety-critical tests (must pass)
    slow: Slow-running tests (>5s, skip in fast mode)
    flaky: Known flaky tests (investigate separately)

    # Environment requirements
    ros2: Tests requiring ROS2 environment
    launch_testing: Tests using launch_testing framework (ROS2 Jazzy best practice)
    hardware: Tests requiring physical hardware
    simulation: Tests requiring Gazebo simulation
    network: Tests requiring network connectivity

    # Component focus
    autonomy: Autonomous operation tests
    perception: Vision and sensor processing tests
    control: Motor control and hardware interface tests
    navigation: Path planning and localization tests
    mission: Mission execution and coordination tests
    state_machine: State machine and behavior tree tests
    communication: Network and inter-system communication tests

    # Special categories
    competition: URC competition specific scenarios
    endurance: Long-duration stability tests
    chaos: Chaos engineering and fault injection tests
    security: Security validation tests
    calibration: Sensor calibration tests

# Exclude directories from test discovery
norecursedirs =
    .git
    __pycache__
    .pytest_cache
    node_modules
    docs/_build
    frontend/dist
    build
    install
    log
    reports
    tools

# Exclude specific files that cause import errors (until deps available)
# Paths relative to rootdir (tests/)
ignore =
    simple_integration_test.py
    integration/test_behavior_tree_optimization.py

# Timeout and performance settings
timeout = 300
timeout_method = thread

# Parallel execution configuration
# -n auto: Use all available CPU cores
# --dist=loadfile: Distribute by file for better isolation
# --maxfail=5: Stop after 5 failures in CI to save time

# Custom test selection for different scenarios
# python_classes = Test* *Test
# python_functions = test_*
